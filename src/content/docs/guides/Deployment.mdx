---
title: Deploy
description: Jak postawi apke na naszym serwerze na coolify?
---

import { Steps } from "@astrojs/starlight/components";

_Kr贸tki poradnik jak postawi apk Adonisow (i nie tylko) na Coolify korzystajc z GitHub App (autodeploy)_

## Repozytorium

Jeli macie gotowy projekt i repo na Solvrowskim GitHubie to mo偶ecie miao zdeploywa wasz apk.  
:::tip
Nawet jeli nie jest gotowy na produkcje, to mo偶ecie ju偶 go zdeployowa i np. ograniczy dostp [https://coolify.io/docs/knowledge-base/traefik/basic-auth/](https://coolify.io/docs/knowledge-base/traefik/basic-auth/)
:::

## Dockerfile (obligatoryjnie)

Coolify u偶ywa [Nixpacka](https://nixpacks.com/docs), kt贸ry na podstawie drzewa projektu jest w stanie wygenerowa obraz kontenera, kt贸ry bdzie chodzi potem na serwerze.

Niestety, Adonisa za pomoc nixpacka tak atwo nie postawicie, wic musicie stworzy dockerfilea - co nie jest zbyt skomplikowane.

Dockerfile najlepiej umieci w rootcie projektu o nazwie `Dockerfile` (tak domylnie Coolify szuka dockerfilea). Pamitajcie, 偶eby pushn dockerfilea do repo na GitHubie.

Link do dockerfilea z adonisowej dokumentacji, kt贸ry mo偶ecie dostosowa do swoich potrzeb:  
[https://docs.adonisjs.com/guides/getting-started/deployment\#creating-a-docker-image](https://docs.adonisjs.com/guides/getting-started/deployment#creating-a-docker-image)

## Coolify

Cr猫me de la cr猫me, dostpny pod adresem https://devops.solvro.pl - o dostpy do zarzdu

_Widok projekt贸w - wszystkie projekty postawione na Coolify_
![](../../../assets/deployment/image8.png)

_Ka偶dy projekt ma swoje zasoby (Resources), kt贸re skadaj si na cay system projektu_
![](../../../assets/deployment/image11.png)

## Baza danych

W naszym przypadku u偶ywamy Postgresql, tu nie ma wikszej filozofii, wystarczy si przeklika i Coolify wszystko za nas ogarnie.

<Steps>

1. Klikamy `New` i tworzymy nowy resource

2. Wybieramy PostgresSQL

3. Wybieramy serwer

   - localhost - typowo produkcyjny serwer, dostpny pod adresami `*.solvro.pl`
   - Seohost - ma wicej ramu i wrzucamy tam mniej wa偶ne projekty albo projekty czonk贸w, dostpny pod adresami `*.s.solvro.pl`

4. Wybieramy domylnego Postgresa

5. Ewentualnie zmieniamy nazw na adniejsz

6. Mo偶na odpala 

</Steps>

![](../../../assets/deployment/image14.png)

Wa偶ne dane, kt贸re bd potrzebne do env贸w na backendzie:

- Username
- Password
- PostgresSQL URL (internal)
  - **postgres://\{username\}:\{password\}@\{host\}:\{port\}/\{database\}**

## Aplikacja

### Tworzenie resource'a

<Steps>

1. Klikamy `New` i tworzymy nowy resource

2. Wybieramy Private Repository (with GitHub App) - nie sugerujcie si nazw, z publicznym repo bdzie dziaa

3. Wybieramy serwer

   - localhost - typowo produkcyjny serwer, dostpny pod adresami `*.solvro.pl`
   - Seohost - ma wicej ramu i wrzucamy tam mniej wa偶ne projekty albo projekty czonk贸w, dostpny pod adresami `*.s.solvro.pl`

4. Wybieramy Github App

5. Wybieramy repozytorium

6. Wybieramy brancha, kt贸rego Coolify ma deployowa  
    Wybieramy jak Coolify ma tworzy obraz kontenera (zawsze **Dockerfile** przy Adonisie)
   ![](../../../assets/deployment/image13.png)
7. Powinno dziaa 

</Steps>

### General

Po udanym procesie tworzenia resourcea powinnicie ujrze nastpujcy widok

![](../../../assets/deployment/image17.png)
:::tip
Po zmianach w zakadce zapisujcie zmiany, 偶eby potem nie wychodziy jakie kwiatki.

![](../../../assets/deployment/image2.png)
:::

Na pocztku warto zmieni nazw na bardziej czyteln, zmieni domen \{poddomena\}.solvro.pl, ewentualnie doda opis.  
Przykad:
![](../../../assets/deployment/image3.png)

Jeli macie monorepo to warto te偶 zmieni Base Directory, jeli macie np. w jednym repo frontend i backend.  
Przykad z [Planera](https://github.com/Solvro/web-planer) :
![](../../../assets/deployment/image21.png)

#### Network

Ports Exposes jest istotny, domylnie Adonis sucha na porcie 3333 - jeli ustawilicie inny w env-ach to zmiecie na ten z env-贸w.  
Porst mappings - jeli nie macie konkretnych powod贸w, to nie zmieniajcie mapowania port贸w do hosta.
![](../../../assets/deployment/image5.png)

Zakadka Pre/Post Deployment Commands jest u偶yteczna, jeli chcecie, 偶eby po ka偶dym deployu jaka akcja si wykonaa - w naszym przypadku wykonujemy migracje:

```sh
node ace migration:run --force
```

### Advanced

W advanceach warto zaznaczy Preview Deployments co pozwoli na sprawdzenie dziaania aplikacji po otworzeniu pull requestu na repo.
Ostatnio (11.2024) Bartosz pisa, 偶e automatyczne preview deployments s wyczone i jeli chcemy zrobi preview deployment, to musimy sobie wyklika.

![](../../../assets/deployment/image20.png)

### Preview deployments

![](../../../assets/deployment/image22.png)

### Zmienne rodowiskowe

Kolejna wa偶na zakadka, Enviroment Variables - tu ustawiacie niezbdne zmienne rodowiskowe.

![](../../../assets/deployment/image19.png)

Polecam wej w widok developerski, przeklei envy z folderu projektu adonisa i poustawia odpowiednie wartoci:

![](../../../assets/deployment/image16.png)

Dane do zmiennych zaczynajcych si od DB\_\{zmienna\} wycigacie z bazy kt贸r uprzednio utworzylicie, wszystkie dane mo偶ecie wycign z URLa bazy:

![](../../../assets/deployment/image15.png)
_**postgres://\{username\}:\{password\}@\{host\}:\{port\}/\{database\}**_

Jeli nie chcecie rcznie przekleja danych z url'a mo偶ecie poprosi Gepetto albo Kloda (jest to wzgldnie bezpieczne)

### Source

W Sourcie mozecie wybra brancha, kt贸rego chcecie deployowa.

![](../../../assets/deployment/image6.png)

### Health checks

Jeli nie chcecie mie irytujcego warningu koo statusu resourcea to mo偶ecie ustawi healthchecki [https://coolify.io/docs/knowledge-base/health-checks/](https://coolify.io/docs/knowledge-base/health-checks/)

![](../../../assets/deployment/image10.png)

### Deployments

Zdarzy si mo偶e, 偶e w trakcie deploy-u co si wykrzaczy - na ratunek przychodzi zakadka _Deployments_, w kt贸rej mo偶ecie sprawdzi logi wszystkich deploy-贸w i naprawi usterk.

![](../../../assets/deployment/image23.png)

### Terminal

Jeli macie uprawnienia admina to, macie mo偶liwo poczenia si do kontenera przez terminal. Mo偶na to zrobi na 2 sposoby:

1. Bdc w resourcie przej do zakadki _Terminal_ - jeli mamy wicej ni偶 1 deploy, to trzeba wybra, do kt贸rego kontenera chcemy si poczy.
2. Klikn na sidebarze w _Terminal_, a nastpnie wybra kontener (z wszystkich dostpnych na serwerze), do kt贸rego chcemy si poczy.

Po wicej szczeg贸贸w: [https://coolify.io/docs/](https://coolify.io/docs/)
